<!doctype html>
<html>
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>ADB Link Generator</title>
  <style>
    body{font-family:system-ui,Arial;margin:0;background:#0b0f1a;color:#fff}
    .wrap{max-width:720px;margin:0 auto;padding:16px}
    .card{background:#121a2a;border:1px solid #22314f;border-radius:14px;padding:14px;margin:12px 0}
    input,button{font-size:16px;padding:12px;border-radius:12px;border:1px solid #2a3b60;background:#0e1524;color:#fff;width:100%}
    button{cursor:pointer;border:none}
    button.primary{background:#2b6cff;font-weight:800}
    .row{display:flex;gap:10px;flex-wrap:wrap}
    .row > *{flex:1;min-width:220px}
    .mono{font-family:ui-monospace,Menlo,Consolas,monospace;word-break:break-all}
    .small{font-size:13px;opacity:.8}
  </style>
</head>
<body>
  <div class="wrap">
    <div class="card">
      <h2 style="margin:0 0 10px 0">Create ADB Signing Link</h2>

      <div class="small">These values get saved with the token so the signed record always ties back to you.</div>

      <div class="row" style="margin-top:12px">
        <input id="agentName" placeholder="Agent Name (Sponsor)" />
        <input id="agencyName" placeholder="Agency Name" />
      </div>
      <div class="row">
        <input id="agencyPhone" placeholder="Agency Phone" />
        <button id="createBtn" class="primary">Generate Link</button>
      </div>

      <div id="status" class="small" style="margin-top:10px"></div>

      <div id="outWrap" style="display:none;margin-top:12px">
        <div class="small">Send this link to the client:</div>
        <div id="out" class="mono" style="background:#0e1524;border:1px solid #2a3b60;border-radius:12px;padding:12px;margin-top:8px"></div>
        <div class="row" style="margin-top:10px">
          <button id="copyBtn">Copy Link</button>
          <button id="openBtn">Open Link</button>
        </div>
      </div>
    </div>
  </div>

<script>
/* =========================
   CONFIG
========================= */
const WORKER_BASE = "https://YOUR-WORKER-DOMAIN"; // <-- CHANGE THIS
const ADB_API_URL = `${WORKER_BASE}/adb`;

// client public URL:
const CLIENT_BASE = "https://www.nf-financial.life/ADB/?adb=";

/* =========================
   HELPERS
========================= */
function tokenGen(len=22){
  const chars="ABCDEFGHJKLMNPQRSTUVWXYZabcdefghijkmnopqrstuvwxyz23456789";
  let out="";
  crypto.getRandomValues(new Uint8Array(len)).forEach(n=>{
    out += chars[n % chars.length];
  });
  return out;
}

async function postJSON(url, payload){
  const res = await fetch(url, {
    method:"POST",
    headers:{ "Content-Type":"application/json" },
    body: JSON.stringify(payload)
  });
  const json = await res.json().catch(()=>({}));
  if (!res.ok || json.ok === false) {
    throw new Error(json.error || `Request failed (${res.status})`);
  }
  return json;
}

/* =========================
   MAIN
========================= */
const agentNameEl = document.getElementById("agentName");
const agencyNameEl = document.getElementById("agencyName");
const agencyPhoneEl = document.getElementById("agencyPhone");
const statusEl = document.getElementById("status");

const outWrap = document.getElementById("outWrap");
const outEl = document.getElementById("out");
const copyBtn = document.getElementById("copyBtn");
const openBtn = document.getElementById("openBtn");

let currentLink = "";

document.getElementById("createBtn").addEventListener("click", async ()=>{
  try{
    statusEl.textContent = "Creating tokenâ€¦";

    const agentName = agentNameEl.value.trim();
    if (!agentName) throw new Error("Agent Name required");

    const token = tokenGen();

    await postJSON(ADB_API_URL, {
      action: "createToken",
      token,
      agentName,
      agencyName: agencyNameEl.value.trim(),
      agencyPhone: agencyPhoneEl.value.trim()
    });

    currentLink = CLIENT_BASE + encodeURIComponent(token);

    outEl.textContent = currentLink;
    outWrap.style.display = "block";
    statusEl.textContent = "Saved. Send link to client.";

    copyBtn.onclick = async ()=> {
      await navigator.clipboard.writeText(currentLink);
      statusEl.textContent = "Copied.";
    };

    openBtn.onclick = ()=> window.open(currentLink, "_blank");

  } catch(err){
    statusEl.textContent = "Error: " + err.message;
  }
});
</script>
</body>
</html>
